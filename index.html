<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Pakistan Tehsils Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Leaflet CSS & JS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>

  <!-- Leaflet GeometryUtil for area calculation -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-geometryutil/0.9.3/leaflet.geometryutil.min.js"></script>

  <!-- Empty favicon to avoid 404 -->
  <link rel="icon" href="data:,">

  <!-- Styles -->
  <style>
    html, body {
        height: 100%;
        margin: 0;
        padding: 0;
    }

    body {
        display: flex;
        font-family: Arial, sans-serif;
    }

    #sidebar {
        width: 25%;
        background: #f8f9fa;
        overflow-y: auto;
        padding: 10px;
        border-right: 1px solid #ccc;
    }

    #map {
        flex: 1;
        height: 100%;
    }

    .district-item {
        cursor: pointer;
        padding: 5px;
        margin: 2px 0;
        border-radius: 5px;
    }

    .district-item:hover {
        background-color: #e0e0e0;
    }
  </style>
</head>
<body>
  <div id="sidebar"></div>
  <div id="map"></div>

  <script>
    (function(){
      // Initialize map centered on Pakistan
      var map = L.map('map').setView([30.0, 70.0], 5);

      // Add OpenStreetMap tiles
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: '&copy; OpenStreetMap contributors'
      }).addTo(map);

      // Styles
      function defaultStyle(feature) {
          return { fillColor: 'lightgray', color: 'black', weight: 1, fillOpacity: 0.5 };
      }

      function highlightStyle() {
          return { fillColor: 'lightblue', color: 'blue', weight: 2, fillOpacity: 0.7 };
      }

      var geojsonLayer;

      // Load GeoJSON
      fetch('pakistan_districts.geojson')
        .then(response => {
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            return response.json();
        })
        .then(data => {
            console.log("GeoJSON loaded successfully!");
            console.log("First feature properties:", data.features[0].properties);

            // Create GeoJSON layer with filter to skip Points (cities)
            geojsonLayer = L.geoJSON(data, {
                style: defaultStyle,
                filter: f => f.geometry.type === "Polygon" || f.geometry.type === "MultiPolygon",
                onEachFeature: function(feature, layer) {
                    if (feature.properties && feature.properties.ADM2_EN) {
                        layer.bindTooltip(feature.properties.ADM2_EN);
                    }
                }
            }).addTo(map);

            // Zoom to show all districts
            let bounds = geojsonLayer.getBounds();
if (bounds.isValid()) {
    map.fitBounds(bounds);
} else {
    console.warn("GeoJSON layer bounds are not valid.");
}

            // Build sidebar
            let sidebar = document.getElementById('sidebar');
            data.features.forEach(feature => {
                let name = feature.properties.ADM2_EN; // change if your GeoJSON uses a different property
                if (!name) return;

                let div = document.createElement('div');
                div.className = 'district-item';
                div.textContent = name;

                div.onclick = () => {
    geojsonLayer.eachLayer(layer => {
        geojsonLayer.resetStyle(layer);

        if (layer.feature.properties.ADM2_EN === name) {
            layer.setStyle(highlightStyle());
            map.fitBounds(layer.getBounds());

            // Calculate area in km²
            let latlngs = layer.getLatLngs();
            let area = 0;

            if (layer.feature.geometry.type === "MultiPolygon") {
                latlngs.forEach(polygon => {
                    polygon.forEach(ring => {
                        area += L.GeometryUtil.geodesicArea(ring);
                    });
                });
            } else { // Polygon
                latlngs.forEach(ring => {
                    area += L.GeometryUtil.geodesicArea(ring);
                });
            }

            area = area / 1000000; // m² → km²
            alert(`District: ${name}\nArea: ${area.toFixed(2)} km²`);
        }
    });
};

                sidebar.appendChild(div);
            });

        })
        .catch(err => {
            console.error("Error loading GeoJSON:", err);
            document.getElementById('sidebar').innerHTML = `<p style="color:red;font-weight:bold;">Error: ${err.message}. Check console.</p>`;
        });
    })();
  </script>
</body>
</html>


