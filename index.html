<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Pakistan Tehsils Map</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin></script>
<link rel="icon" href="data:,">
<style>
html, body { height: 100%; margin: 0; padding: 0; }
body { display: flex; font-family: Arial, sans-serif; }
#sidebar { width: 25%; background: #f8f9fa; overflow-y: auto; padding: 10px; border-right: 1px solid #ccc; }
#map { flex: 1; height: 100%; position: relative; }
#info-box { position: absolute; top: 10px; left: 30%; transform: translateX(-50%);
            z-index: 1000; padding: 8px 15px; background: rgba(255,255,255,0.95);
            border: 1px solid #333; border-radius: 5px; font-weight: bold;
            pointer-events: none; box-shadow: 0 2px 6px rgba(0,0,0,0.3); display: block; }
h3 { margin: 10px 0 5px 0; font-size: 16px; color: #222; cursor: default; }
.district-item { cursor: pointer; padding: 5px; margin: 2px 0; border-radius: 5px; padding-left: 15px; }
.district-item:hover { background-color: #e0e0e0; }
.toggle-container { margin-bottom: 10px; }
button { display:block; margin-top: 5px; }
</style>
</head>
<body>

<div id="sidebar">
    <div class="toggle-container">
        <input type="checkbox" id="toggle-callout" checked>
        <label for="toggle-callout">Show Callout</label>
    </div>
    <div class="toggle-container">
        <input type="checkbox" id="toggle-tooltip" checked>
        <label for="toggle-tooltip">Show Hover Tooltip</label>
    </div>
    <div class="toggle-container">
        <label for="color-picker">Select Dist Highlight Color:</label><br>
        <input type="color" id="color-picker" value="#ffa500" style="width:55%; margin-top:10px;">
    </div>
    <div class="toggle-container">
        <label for="color-picker-map-bgrd">Select Map Background Color:</label><br>
        <input type="color" id="color-picker-map-bgrd" value="#808080" style="width:55%; margin-top:5px;">
    </div>        
    <div class="toggle-container">
        <label for="color-picker-map-line">Select Map Line Color:</label><br>
        <input type="color" id="color-picker-map-line" value="#ADD8E6" style="width:55%; margin-top:5px;">
    </div>                
    <div class="toggle-container">
        <button id="btn1" style="width:40%;">Cotton</button>
        <button id="btn2" style="width:40%;">Rice</button>
        <button id="btn3" style="width:40%;">Sesame</button>
        <button id="btn4" style="width:40%;">Wheat</button>
    </div>
</div>

<div id="map">
    <div id="info-box">Hover over a tehsil or click to see details here</div>
</div>

<script>
var calloutEnabled = true;
var tooltipEnabled = false;
var highlightColor = "#ffa500";
var mapLineColor = "#808080"; 
var mapColor = "#ADD8E6";  
            
var map = L.map('map').setView([30.0, 70.0], 5);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

var geojsonLayer;
           

// Checkbox toggles
document.getElementById('toggle-callout').addEventListener('change', function() {
  calloutEnabled = this.checked;
  document.getElementById('info-box').style.display = calloutEnabled ? 'block' : 'none';
});

document.getElementById('toggle-tooltip').addEventListener('change', function() {
  tooltipEnabled = this.checked;
});

// Color picker
document.getElementById('color-picker').addEventListener('input', function() {
  highlightColor = this.value;     
});

  
            
            
// Map Background Color picker
document.getElementById('color-picker-map-line').addEventListener('input', function() {
  mapLineColor = this.value;
  geojsonLayer.setStyle({ color: mapLineColor });  // update line color dynamically
});        

// Map Line Color picker
document.getElementById('color-picker-map-bgrd').addEventListener('input', function() {
  mapColor = this.value;
  geojsonLayer.setStyle({ color: mapColor });  // update line color dynamically
});                        

// Load Tehsils
fetch('geoBoundaries-PAK-ADM3.geojson')
.then(r => r.json())
.then(data => {
  geojsonLayer = L.geoJSON(data, {
    style: { fillColor: mapColor, color: mapLineColor, weight: 1, fillOpacity: 0.8 },
    onEachFeature: function(feature, layer) {
    if(feature.properties && feature.properties.shapeName){
        // Bind tooltip (always bound, but visibility controlled)
        layer.bindTooltip(feature.properties.shapeName, {permanent: false});

        // Hover events
        layer.on('mouseover', function(){
            if(calloutEnabled) showInfo(feature.properties.shapeName); // info box
            if(tooltipEnabled) layer.openTooltip();                     // hover tooltip
        });
        layer.on('mouseout', function(){
            if(calloutEnabled) clearInfo();                             // clear info box
            if(tooltipEnabled) layer.closeTooltip();                    // hide tooltip
        });

        // Click highlight
        layer.on('click', function(){
            toggleHighlight(layer);
            if(calloutEnabled) showInfo(feature.properties.shapeName);
        });
    }
}

  }).addTo(map);

  map.fitBounds(geojsonLayer.getBounds());
  buildSidebar(data);
})
.catch(err => console.error("❌ Error loading GeoJSON:", err));

// Sidebar
function buildSidebar(data){
  let sidebar = document.getElementById('sidebar');
  let groups = {};
  data.features.forEach(f => {
    if(f.properties && f.properties.shapeGroup && f.properties.shapeName){
      let group = f.properties.shapeGroup;
      if(!groups[group]) groups[group] = [];
      groups[group].push(f);
    }
  });

  Object.keys(groups).sort().forEach(group => {
    let heading = document.createElement('h3');
    heading.textContent = group;
    sidebar.appendChild(heading);

    groups[group].sort((a,b)=>a.properties.shapeName.localeCompare(b.properties.shapeName))
      .forEach(f => {
        let div = document.createElement('div');
        div.className = 'district-item';
        div.textContent = f.properties.shapeName;
        div.onclick = () => { highlightDistrict(f.properties.shapeName); if(calloutEnabled) showInfo(f.properties.shapeName); };
        sidebar.appendChild(div);
      });
  });
}

// Highlight
function highlightDistrict(name){
  geojsonLayer.eachLayer(layer => {
      if(layer.feature.properties.shapeName === name) toggleHighlight(layer);
  });
}

function toggleHighlight(layer){
  if(layer.options.fillColor === mapColor){
      geojsonLayer.resetStyle(layer);
      layer.closeTooltip();
  } else {
      layer.setStyle({ fillColor: mapColor, color: mapLineColor, weight:2, fillOpacity:0.8 });
      if(tooltipEnabled) layer.openTooltip();
  }
}

            
// Info box
function showInfo(name){ document.getElementById('info-box').innerHTML = "<b>Selected Tehsil:</b> "+name; }
function clearInfo(){ document.getElementById('info-box').innerHTML = "Hover over a tehsil or click to see details here"; }
</script>
</body>
</html>










